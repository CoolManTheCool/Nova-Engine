# Minimum version of CMake required
cmake_minimum_required(VERSION 3.10)

# Project name and version
project(NovaEngine VERSION 1.0)

# Set C++ standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED True)

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/../bin)

set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/../bin)

set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/../bin)

set(CMAKE_BINARY_DIR ${PROJECT_SOURCE_DIR}/build)

include_directories(${PROJECT_SOURCE_DIR}/src)

add_executable(NovaEngine
    src/build_test.cpp
)

# Custom target for shader compilation and resource copying
add_custom_target(CompileShaders ALL
    COMMAND ${CMAKE_COMMAND} -E echo "[ OK ] Compiling shaders"
    COMMAND ${CMAKE_COMMAND} -E remove_directory ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/resources
    COMMAND ${CMAKE_COMMAND} -E make_directory ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/resources
    COMMAND ${CMAKE_COMMAND} -E make_directory ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/resources/shaders

    # Find and compile shader files
    COMMAND ${CMAKE_COMMAND} -E echo "[ OK ] Searching for shaders"
    COMMAND ${CMAKE_COMMAND} -E remove -f ${CMAKE_SOURCE_DIR}/src/resources/shaders/*.spv
    COMMAND ${CMAKE_COMMAND} -E copy_directory ${CMAKE_SOURCE_DIR}/src/resources/shaders ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/resources/shaders

    COMMAND ${CMAKE_COMMAND} -E echo "[ OK ] Compiling vertex shaders"
    COMMAND ${CMAKE_COMMAND} -E find ${CMAKE_SOURCE_DIR}/src/resources/shaders -type f -name "*.vert" -exec glslc {} -o {}.spv \;

    COMMAND ${CMAKE_COMMAND} -E echo "[ OK ] Compiling fragment shaders"
    COMMAND ${CMAKE_COMMAND} -E find ${CMAKE_SOURCE_DIR}/src/resources/shaders -type f -name "*.frag" -exec glslc {} -o {}.spv \;

    # Copy resources
    COMMAND ${CMAKE_COMMAND} -E echo "[ OK ] Copying resources into ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}"
    COMMAND ${CMAKE_COMMAND} -E copy_directory ${CMAKE_SOURCE_DIR}/src/resources ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/resources

    # Clean up shader files
    COMMAND ${CMAKE_COMMAND} -E remove -f ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/resources/shaders/*.spv

    COMMENT "Compiling shaders and copying resources"
)

# Make the custom target depend on the main executable
# add_dependencies(NovaEngine CompileShaders)
